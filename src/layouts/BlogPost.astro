---
import BaseLayout from './BaseLayout.astro';
import { Image } from 'astro:assets';

const base = import.meta.env.BASE_URL;

const { entry, prev, next, morePosts } = Astro.props;
const { title, date, authors, categories, tags, featuredImage, excerpt } = entry.data;
---

<BaseLayout title={`${title} | PowerBI.tips`} description={excerpt ?? ''}>
  <article class="max-w-none space-y-6 text-[1.05rem] leading-relaxed">
    <h1 class="text-4xl font-semibold tracking-tight text-neutral-900">{title}</h1>
    
    <div class="flex flex-wrap items-center gap-4 text-sm text-neutral-500">
      <span>{date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
      {authors?.length && (
        <span>
          By {authors.map((author, i) => (
            <>
              <a 
                href={`${base}author/${author.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')}/`}
                class="text-blue-600 hover:text-blue-700"
              >
                {author}
              </a>
              {i < authors.length - 1 ? ', ' : ''}
            </>
          ))}
        </span>
      )}
    </div>

    {categories?.length ? (
      <div class="flex flex-wrap gap-2">
        {categories.map((category) => (
          <a
            class="rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700"
            href={`${base}category/${category.toLowerCase().replace(/\s+/g, '-')}/`}
          >
            {category}
          </a>
        ))}
      </div>
    ) : null}

    {featuredImage && (
      <Image 
        src={featuredImage} 
        alt={title} 
        class="w-full rounded-xl object-cover"
        widths={[400, 800, 1200]}
        sizes="(max-width: 800px) 100vw, 800px"
      />
    )}

    <div class="prose">
      <slot />
    </div>

    {tags?.length ? (
      <div class="mt-8 flex flex-wrap gap-2">
        {tags.map((tag) => (
          <span class="rounded-full border border-neutral-200 px-3 py-1 text-xs text-neutral-500">#{tag}</span>
        ))}
      </div>
    ) : null}
  </article>

  <div class="mt-12 grid gap-6 border-t border-neutral-200 pt-8 md:grid-cols-2">
    <div>
      <p class="text-xs font-semibold uppercase tracking-wide text-neutral-500">Previous</p>
      {prev ? (
        <a class="mt-2 block text-lg font-semibold text-blue-600 hover:text-blue-700" href={`${base}${prev.slug}/`}>
          {prev.data.title}
        </a>
      ) : (
        <p class="mt-2 text-sm text-neutral-500">No previous post</p>
      )}
    </div>
    <div class="md:text-right">
      <p class="text-xs font-semibold uppercase tracking-wide text-neutral-500">Next</p>
      {next ? (
        <a class="mt-2 block text-lg font-semibold text-blue-600 hover:text-blue-700" href={`${base}${next.slug}/`}>
          {next.data.title}
        </a>
      ) : (
        <p class="mt-2 text-sm text-neutral-500">No next post</p>
      )}
    </div>
  </div>

  {morePosts?.length ? (
    <section class="mt-12">
      <h2 class="text-xl font-semibold">More Posts</h2>
      <div class="mt-6 grid gap-6 md:grid-cols-3">
        {morePosts.map((post) => (
          <article class="rounded-xl border border-neutral-200 p-5">
            <p class="text-xs font-semibold uppercase tracking-wide text-neutral-500">
              {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
            </p>
            <h3 class="mt-2 text-lg font-semibold">
              <a class="text-blue-600 hover:text-blue-700" href={`${base}${post.slug}/`}>
                {post.data.title}
              </a>
            </h3>
            {post.data.excerpt && <p class="mt-2 text-sm text-neutral-600">{post.data.excerpt}</p>}
          </article>
        ))}
      </div>
    </section>
  ) : null}
</BaseLayout>
