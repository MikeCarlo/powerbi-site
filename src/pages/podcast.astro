---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');

// Get all podcast episodes
const allPosts = await getCollection('blog');
const podcastPosts = allPosts
  .filter(post => post.data.categories.includes('Podcast'))
  .map(post => {
    // Extract episode number from title — must match "Ep. 498" or "Episode 500" patterns
    const epMatch = post.data.title.match(/\bEp\.?\s*(\d+)\b|\bEpisode\s+(\d+)\b/i);
    const epNumber = epMatch ? parseInt(epMatch[1] || epMatch[2]) : 0;
    // Clean slug: strip index.mdx suffix
    const slug = post.id.replace(/\/index\.mdx?$/, '').replace(/\.mdx?$/, '');
    return { ...post, epNumber, slug };
  })
  .sort((a, b) => b.epNumber - a.epNumber || b.data.date.getTime() - a.data.date.getTime());
---

<BaseLayout title="The Podcast | PowerBI.tips" description="The Explicit Measures Podcast - a Power BI centric show with Mike Carlo and Tommy Puglia. Live every Tuesday and Thursday at 7:30 AM CST.">
  <section class="mb-12">
    <h1 class="text-4xl font-semibold tracking-tight text-neutral-900">
      The Podcast
    </h1>

    <img
      src={`${base}/images/podcast/podcast-hero.jpg`}
      alt="Explicit Measures Podcast"
      class="rounded-2xl w-full max-w-4xl mt-6"
      loading="lazy"
    />

    <p class="mt-4 max-w-3xl text-lg text-neutral-600">
      The <a href="https://anchor.fm/explicitmeasures" class="text-blue-600 hover:underline">Explicit Measures Podcast</a> is a Power BI centric show with <a href="https://www.linkedin.com/in/michaelcarlo/" class="text-blue-600 hover:underline">Mike Carlo</a> and <a href="https://www.linkedin.com/in/tommypuglia/" class="text-blue-600 hover:underline">Tommy Puglia</a>.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">How To Listen</h2>
    <p class="text-neutral-600 mb-4">
      The Podcast airs live every Tuesday and Thursday at 7:30 AM CST (-6 UTC) on YouTube. You can follow on the <a href="https://www.youtube.com/powerbitips" class="text-blue-600 hover:underline">PowerBI.Tips YouTube Channel</a>, and check <a href="https://www.linkedin.com/company/powerbitips/" class="text-blue-600 hover:underline">LinkedIn</a> and <a href="https://twitter.com/PowerBITips" class="text-blue-600 hover:underline">Twitter</a> for links to the live streams.
    </p>
    <p class="text-neutral-600">
      All of the episodes are available on most podcast platforms the same day as the live stream. You can subscribe on Apple, Spotify, or wherever you listen.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">Listen on Apple Podcasts</h2>
    <a href="https://podcasts.apple.com/us/podcast/explicit-measures-podcast/id1568944083?itsct=podcast_box_badge&itscg=30200" class="inline-block">
      <img 
        src="https://tools.applemediaservices.com/api/badges/listen-on-apple-podcasts/badge/en-us?size=250x83" 
        alt="Listen on Apple Podcasts" 
        class="rounded-xl h-20"
        loading="lazy"
      />
    </a>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">Listen on Spotify</h2>
    <iframe 
      src="https://open.spotify.com/embed/show/230fp78XmHHRXTiYICRLVv?utm_source=generator" 
      width="100%" 
      height="232" 
      frameborder="0" 
      allowfullscreen 
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
      class="rounded-xl"
      loading="lazy"
    ></iframe>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">Join Us Live</h2>
    <p class="text-neutral-600 mb-6">
      If just listening isn't enough, you can join us live on YouTube where every episode is streamed Live.
    </p>
    <div class="aspect-video max-w-2xl">
      <iframe 
        title="Explicit Measures - Podcast" 
        width="100%" 
        height="100%" 
        src="https://www.youtube.com/embed/videoseries?list=PLn1m_aBmgsbHr83c1P6uqaWF5PLdFzOjj" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
        referrerpolicy="strict-origin-when-cross-origin" 
        allowfullscreen
        class="rounded-xl"
        loading="lazy"
      ></iframe>
    </div>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">About the Podcast</h2>
    <p class="text-neutral-600 mb-4">
      We just love talking about Power BI. Many of our conversations would be common around your water cooler at work. So many available resources in the community focus on the "how" in Power BI — for example, how to do Drill Through, or how to use DAX. The Explicit Measures Podcast is all about the <strong>WHY</strong>.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">Addressing the Why</h2>
    <ul class="list-disc list-inside text-neutral-600 space-y-2">
      <li>Why use a particular feature</li>
      <li>Does it make sense for my users?</li>
      <li>What does this mean for me to implement a feature?</li>
      <li>How Power BI is going to be used and consumed?</li>
    </ul>
    <p class="text-neutral-600 mt-4">
      The Podcast speaks to these additional topics. We aim to put practical knowledge in your hands. We hope you will enjoy our bi-weekly podcast.
    </p>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-4">Mail Bag</h2>

    <a
      href="https://forms.office.com/r/FhmKGs9WmT"
      class="inline-block"
      target="_blank"
      rel="noopener noreferrer"
    >
      <img
        src={`${base}/images/podcast/mailbag.jpg`}
        alt="Mail Bag - click to submit a question"
        class="rounded-xl max-w-sm w-full"
        loading="lazy"
      />
    </a>
  </section>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold text-neutral-900 mb-6">Episodes</h2>

    {podcastPosts.length > 0 ? (
      <div class="space-y-4">
        {podcastPosts.map(post => {
          const slug = post.slug;
          const href = `${base}/${slug}/`;
          const dateStr = post.data.date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
          });
          return (
            <a href={href} class="block group">
              <div class="flex items-baseline gap-3 py-2 border-b border-neutral-200 group-hover:border-neutral-400 transition-colors">
                {post.epNumber > 0 && (
                  <span class="text-sm font-medium text-neutral-400 whitespace-nowrap">
                    Ep. {post.epNumber}
                  </span>
                )}
                <span class="text-neutral-900 group-hover:text-blue-600 transition-colors font-medium">
                  {post.data.title}
                </span>
                <span class="text-sm text-neutral-400 whitespace-nowrap ml-auto">
                  {dateStr}
                </span>
              </div>
            </a>
          );
        })}
      </div>
    ) : (
      <p class="text-neutral-500">No episodes found.</p>
    )}
  </section>
</BaseLayout>
