---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const base = import.meta.env.BASE_URL;

// Extract all unique authors
const authorMap = new Map();

posts.forEach(post => {
  post.data.authors?.forEach(author => {
    const slug = author.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
    if (!authorMap.has(slug)) {
      authorMap.set(slug, { name: author, slug, count: 0 });
    }
    authorMap.get(slug).count++;
  });
});

const authors = Array.from(authorMap.values()).sort((a, b) => b.count - a.count);
---

<BaseLayout title="Authors | PowerBI.tips" description="All authors on PowerBI.tips">
  <section class="mb-12">
    <p class="text-sm font-semibold uppercase tracking-wide text-blue-600">PowerBI.tips</p>
    <h1 class="mt-3 text-4xl font-semibold tracking-tight text-neutral-900">
      Authors
    </h1>
    <p class="mt-4 text-lg text-neutral-600">
      Meet the people behind PowerBI.tips
    </p>
  </section>

  <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
    {authors.map((author) => (
      <a 
        href={`${base}author/${author.slug}/`}
        class="rounded-xl border border-neutral-200 p-6 transition-colors hover:border-blue-300 hover:bg-blue-50/50"
      >
        <h2 class="text-lg font-semibold text-neutral-900">{author.name}</h2>
        <p class="mt-1 text-sm text-neutral-500">
          {author.count} {author.count === 1 ? 'post' : 'posts'}
        </p>
      </a>
    ))}
  </div>
</BaseLayout>
